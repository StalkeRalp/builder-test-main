<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nouveau Projet - TDE Group Admin</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="./styles/admin-layout.css">
    <style>
        /* ===== VARIABLES ET RESET ===== */
        :root {
            --primary: #0d9488;
            --primary-dark: #0f766e;
            --primary-light: #14b8a6;
            --secondary: #3b82f6;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray: #64748b;
            --light-gray: #f8fafc;
            --border: #e5e7eb;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e6edf5 100%);
            min-height: 100vh;
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .content {
            max-width: none;
            margin: 0;
            padding: 24px 8px 24px 28px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 28px;
            align-items: start;
        }

        /* ===== FORMULAIRE STYLIS√â ===== */
        .form-wrapper {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            border: 1px solid rgba(13, 148, 136, 0.1);
            transition: var(--transition);
        }

        .form-wrapper:hover {
            box-shadow: 0 20px 25px -5px rgba(13, 148, 136, 0.1), 0 10px 10px -5px rgba(13, 148, 136, 0.04);
        }

        /* Header avec d√©grad√© am√©lior√© */
        .form-header {
            background: linear-gradient(135deg, #0f172a, #1e293b, #0d9488);
            color: white;
            padding: 32px 40px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        .form-header::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .form-header::after {
            content: "";
            position: absolute;
            bottom: -30%;
            left: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(13,148,136,0.2) 0%, transparent 70%);
            border-radius: 50%;
        }

        .form-header span.material-icons {
            font-size: 42px;
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: var(--radius-md);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            z-index: 1;
        }

        .form-header h2 {
            margin: 0;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
        }

        .form-header p {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 4px;
            position: relative;
            z-index: 1;
        }

        /* Corps du formulaire */
        .form-body {
            padding: 40px 40px 40px 52px;
            background: white;
        }

        /* Sections */
        .form-section {
            margin-bottom: 40px;
            background: var(--light-gray);
            border-radius: var(--radius-md);
            padding: 24px 24px 24px 28px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .form-section:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--dark);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .section-title .material-icons {
            color: var(--primary);
            font-size: 24px;
            background: rgba(13, 148, 136, 0.1);
            padding: 6px;
            border-radius: var(--radius-sm);
        }

        /* Grilles responsives */
        .form-grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            margin-left: 8px;
        }

        .form-grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            margin-left: 8px;
        }

        /* Champs de formulaire */
        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-group label .required {
            color: var(--danger);
            font-size: 16px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            transition: var(--transition);
            background: white;
        }

        .form-group input:hover,
        .form-group select:hover,
        .form-group textarea:hover {
            border-color: var(--primary-light);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.1);
        }
        .form-group input:focus-visible,
        .form-group select:focus-visible,
        .form-group textarea:focus-visible {
            outline: 2px solid rgba(13,148,136,0.35);
            outline-offset: 1px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group.full {
            grid-column: 1 / -1;
            margin-left: 8px;
        }

        /* Bo√Æte d'information */
        .info-box {
            background: linear-gradient(135deg, #f0f9ff, #e6f3f0);
            border-left: 4px solid var(--primary);
            padding: 16px 20px;
            border-radius: var(--radius-sm);
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            align-items: flex-start;
            border: 1px solid rgba(13, 148, 136, 0.2);
        }

        .info-box .material-icons {
            color: var(--primary);
            font-size: 24px;
            flex-shrink: 0;
        }

        .info-box-text {
            font-size: 14px;
            color: var(--dark);
            line-height: 1.6;
        }

        .info-box-text strong {
            color: var(--primary-dark);
        }

        /* G√©n√©rateurs automatiques */
        .auto-generate-box {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border: 2px dashed var(--border);
            border-radius: var(--radius-md);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: space-between;
            transition: var(--transition);
        }

        .auto-generate-box:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
        }

        .auto-generate-box .left {
            flex: 1;
        }

        .auto-generate-box .label {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
            margin-bottom: 6px;
        }

        .auto-generate-box .value {
            background: white;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-dark);
            word-break: break-all;
            border: 1px solid var(--border);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }

        .auto-generate-box .btn-mini {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 10px 18px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            white-space: nowrap;
        }

        .auto-generate-box .btn-mini:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(13, 148, 136, 0.3);
        }
        .auto-generate-box .btn-mini:focus-visible { outline: 2px solid rgba(13,148,136,0.35); outline-offset: 2px; }

        .auto-generate-box .btn-mini:active {
            transform: translateY(0);
        }

        .auto-generate-box .btn-mini .material-icons {
            font-size: 18px;
        }

        /* Boutons d'action */
        .button-group {
            display: flex;
            gap: 16px;
            margin-top: 40px;
        }

        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
            font-size: 15px;
            flex: 1;
            letter-spacing: 0.3px;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(13, 148, 136, 0.4);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-cancel {
            background: white;
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-cancel:hover {
            background: #fee2e2;
            border-color: var(--danger);
            color: var(--danger);
            transform: translateY(-2px);
        }
        .btn:focus-visible { outline: 2px solid rgba(13,148,136,0.35); outline-offset: 2px; }

        /* ===== PANEL LAT√âRAL ===== */
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 24px;
            position: sticky;
            top: 90px;
        }

        .panel-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            border: 1px solid rgba(13, 148, 136, 0.1);
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .panel-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .panel-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .panel-title .material-icons {
            color: var(--primary);
            font-size: 22px;
        }

        /* Actions rapides */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .quick-actions button {
            width: 100%;
            border: 1px solid var(--border);
            background: linear-gradient(135deg, white, var(--light-gray));
            padding: 14px 18px;
            border-radius: var(--radius-md);
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            font-size: 14px;
        }

        .quick-actions button:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            transform: translateX(6px);
            box-shadow: var(--shadow-md);
        }
        .quick-actions button:focus-visible { outline: 2px solid rgba(13,148,136,0.35); outline-offset: 2px; }

        .quick-actions button .material-icons {
            color: var(--primary);
            font-size: 20px;
        }

        /* Checklist */
        .checklist {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .checklist span {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: var(--dark);
            padding: 8px 12px;
            background: var(--light-gray);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .checklist span:hover {
            background: #ecfdf5;
            transform: translateX(4px);
        }

        .checklist .material-icons {
            font-size: 18px;
        }

        /* R√©sum√© */
        .summary-chip {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            color: var(--primary-dark);
            padding: 16px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(13, 148, 136, 0.2);
        }

        .summary-chip .material-icons {
            color: var(--primary);
            font-size: 22px;
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast-container {
            position: fixed;
            right: 28px;
            top: 100px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }

        .toast {
            padding: 16px 20px;
            border-radius: var(--radius-md);
            color: var(--dark);
            background: white;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 14px;
            min-width: 300px;
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid var(--success);
            background: linear-gradient(135deg, #f0fdf4, white);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
            background: linear-gradient(135deg, #fef2f2, white);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
            background: linear-gradient(135deg, #fffbeb, white);
        }

        .toast .material-icons {
            font-size: 22px;
        }

        .toast.success .material-icons { color: var(--success); }
        .toast.error .material-icons { color: var(--danger); }
        .toast.warning .material-icons { color: var(--warning); }

        /* ===== MODAL DE CONFIRMATION ===== */
        .image-modal {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 20px;
            backdrop-filter: blur(8px);
        }

        .image-modal.open {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .image-modal-content {
            background: white;
            border-radius: var(--radius-lg);
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .image-modal-actions {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(13, 148, 136, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 1px solid var(--border);
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: var(--light-gray);
            border-color: var(--gray);
        }

        /* ===== ANIMATIONS ===== */
        .loading {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .form-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border), transparent);
            margin: 32px 0;
        }

        .form-tip {
            font-size: 12px;
            color: var(--gray);
            margin-top: 12px;
            font-style: italic;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .side-panel {
                position: static;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }

            .form-body { padding: 32px; }
            .form-grid-2, .form-grid-3, .form-group.full { margin-left: 0; }
        }

        @media (max-width: 768px) {
            .content {
                padding: 16px;
            }
            
            .form-body {
                padding: 20px;
            }
            
            .form-header {
                padding: 24px;
            }
            
            .form-header h2 {
                font-size: 24px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .auto-generate-box {
                flex-direction: column;
                align-items: stretch;
            }
            
            .auto-generate-box .btn-mini {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar (inchang√©e) -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <span class="material-icons">apartment</span>
            <div class="logo-text">
                <span>TDE GROUP</span>
                <small>TOGETHER WE MAKE IT!</small>
            </div>
        </div>
        <nav class="sidebar-menu">
            <a href="index.html" class="sidebar-item">
                <span class="material-icons">dashboard</span>
                <span>Dashboard</span>
            </a>
            <a href="create-project.html" class="sidebar-item active">
                <span class="material-icons">add_circle</span>
                <span>Nouveau Projet</span>
            </a>
            <a href="clients.html" class="sidebar-item">
                <span class="material-icons">groups</span>
                <span>Clients (CRM)</span>
            </a>
            <a href="tickets.html" class="sidebar-item">
                <span class="material-icons">support_agent</span>
                <span>Support</span>
            </a>
            <a href="messages.html" class="sidebar-item">
                <span class="material-icons">mail</span>
                <span>Messages</span>
            </a>
            <a href="calendar.html" class="sidebar-item">
                <span class="material-icons">calendar_today</span>
                <span>Calendrier</span>
            </a>
            <a href="reports.html" class="sidebar-item">
                <span class="material-icons">assessment</span>
                <span>Rapports</span>
            </a>
            <a href="profile.html" class="sidebar-item">
                <span class="material-icons">account_circle</span>
                <span>Profil</span>
            </a>
            <a href="../client/login.html" class="sidebar-item" target="_blank" rel="noopener">
                <span class="material-icons">visibility</span>
                <span>My Project (Client)</span>
            </a>
            <div class="sidebar-logout">
                <button class="sidebar-item" onclick="logout()">
                    <span class="material-icons">logout</span>
                    <span>D√©connexion</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="header-title">
                <span class="material-icons">add_circle</span>
                <div>
                    <span>Cr√©er un Projet</span>
                    <small>Nouveau projet TDE Group</small>
                </div>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <span class="material-icons">search</span>
                    <input type="text" placeholder="Rechercher un projet, client...">
                </div>
                <div class="user-profile">
                    <div class="user-avatar" id="userInitials">AD</div>
                    <div class="user-info">
                        <span>Admin</span>
                        <small>Connect√©</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenu -->
        <div class="content">
            <div class="content-grid">
                <!-- Formulaire principal -->
                <div class="form-wrapper">
                    <div class="form-header">
                        <span class="material-icons">folder_open</span>
                        <div>
                            <h2>Nouveau Projet</h2>
                            <p>Cr√©ez un projet en quelques clics</p>
                        </div>
                    </div>

                    <form id="createProjectForm" class="form-body">
                        <!-- Section 1: Informations du Projet -->
                        <div class="form-section">
                            <div class="section-title">
                                <span class="material-icons">info</span>
                                Informations du Projet
                            </div>
                            
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label>
                                        Nom du Projet 
                                        <span class="required">*</span>
                                    </label>
                                    <input type="text" id="name" name="name" placeholder="Ex: Portal Web Client" required>
                                </div>

                                <div class="form-group">
                                    <label>
                                        Type de Projet 
                                        <span class="required">*</span>
                                    </label>
                                    <select id="type" name="type" required>
                                        <option value="">-- S√©lectionner --</option>
                                        <option value="construction">üèóÔ∏è Construction</option>
                                        <option value="consultancy">üìä Consultancy</option>
                                        <option value="energy">‚ö° √ânergie</option>
                                        <option value="it-services">üíª IT Services</option>
                                        <option value="supply">üì¶ Approvisionnement</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group full">
                                <label>Localisation</label>
                                <input type="text" id="location" name="location" placeholder="Ex: Paris, 75001">
                            </div>

                            <div class="form-group full">
                                <label>Description du Projet</label>
                                <textarea id="description" name="description" placeholder="D√©crivez les objectifs, livrables et d√©tails du projet..."></textarea>
                            </div>
                        </div>

                        <!-- Section 2: Informations Client -->
                        <div class="form-section">
                            <div class="section-title">
                                <span class="material-icons">business</span>
                                Informations Client
                            </div>
                            
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label>
                                        Nom de l'Entreprise 
                                        <span class="required">*</span>
                                    </label>
                                    <input type="text" id="clientName" name="clientName" placeholder="Ex: ACME Corporation" required>
                                </div>

                                <div class="form-group">
                                    <label>
                                        Email du Contact 
                                        <span class="required">*</span>
                                    </label>
                                    <input type="email" id="clientEmail" name="clientEmail" placeholder="contact@client.com" required>
                                </div>
                            </div>

                            <div class="form-group full">
                                <label>T√©l√©phone du Client</label>
                                <input type="tel" id="clientPhone" name="clientPhone" placeholder="+33 6 12 34 56 78">
                            </div>
                        </div>

                        <!-- Section 3: √âquipe du Projet -->
                        <div class="form-section">
                            <div class="section-title">
                                <span class="material-icons">people</span>
                                √âquipe du Projet
                            </div>
                            
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label>
                                        Chef de Projet 
                                        <span class="required">*</span>
                                    </label>
                                    <input type="text" id="projectManager" name="projectManager" placeholder="Ex: Jean Dupont" required>
                                </div>

                                <div class="form-group">
                                    <label>Email du Chef de Projet</label>
                                    <input type="email" id="managerEmail" name="managerEmail" placeholder="chef@tdegroup.com">
                                </div>
                            </div>
                        </div>

                        <!-- Section 4: Timeline et Budget -->
                        <div class="form-section">
                            <div class="section-title">
                                <span class="material-icons">calendar_today</span>
                                Timeline et Budget
                            </div>
                            
                            <div class="form-grid-3">
                                <div class="form-group">
                                    <label>
                                        Date de D√©but 
                                        <span class="required">*</span>
                                    </label>
                                    <input type="date" id="startDate" name="startDate" required>
                                </div>

                                <div class="form-group">
                                    <label>
                                        Date de Fin 
                                        <span class="required">*</span>
                                    </label>
                                    <input type="date" id="endDate" name="endDate" required>
                                </div>

                                <div class="form-group">
                                    <label>Budget (FCFA)</label>
                                    <input type="number" id="budget" name="budget" placeholder="500 000" min="0" step="100">
                                </div>
                            </div>

                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label>Statut du Projet</label>
                                    <select id="status" name="status">
                                        <option value="planning">üìã Planning</option>
                                        <option value="in_progress">üöß En cours</option>
                                        <option value="paused">‚è∏Ô∏è En pause</option>
                                        <option value="completed">‚úÖ Compl√©t√©</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Section 5: Identifiants Uniques -->
                        <div class="form-section">
                            <div class="section-title">
                                <span class="material-icons">security</span>
                                Identifiants Uniques
                            </div>
                            
                            <div class="info-box">
                                <span class="material-icons">info</span>
                                <div class="info-box-text">
                                    <strong>UUID:</strong> Identifiant unique universel du projet<br>
                                    <strong>PIN:</strong> Code 6 chiffres pour l'acc√®s client s√©curis√©
                                </div>
                            </div>

                            <div class="form-grid-2">
                                <div class="auto-generate-box">
                                    <div class="left">
                                        <div class="label">Project ID (UUID)</div>
                                        <div class="value" id="uuidDisplay">XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</div>
                                    </div>
                                    <button type="button" class="btn-mini" onclick="generateUUID()">
                                        <span class="material-icons">refresh</span>
                                        G√©n√©rer
                                    </button>
                                </div>

                                <div class="auto-generate-box">
                                    <div class="left">
                                        <div class="label">Code PIN (6 chiffres)</div>
                                        <div class="value" id="pinDisplay">000000</div>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <button type="button" class="btn-mini" onclick="generatePIN()">
                                            <span class="material-icons">refresh</span>
                                        </button>
                                        <button type="button" class="btn-mini" onclick="copyPIN()">
                                            <span class="material-icons">content_copy</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 16px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="copyPinOnCreate" style="width: 18px; height: 18px;">
                                    Copier automatiquement le PIN apr√®s cr√©ation
                                </label>
                            </div>
                        </div>

                        <!-- Boutons d'Action -->
                        <div class="button-group">
                            <button type="submit" class="btn btn-submit" id="submitBtn">
                                <span class="material-icons">check_circle</span>
                                Cr√©er le Projet
                            </button>
                            <button type="button" class="btn btn-cancel" onclick="resetForm()">
                                <span class="material-icons">close</span>
                                R√©initialiser
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Panel lat√©ral -->
                <aside class="side-panel">
                    <div class="panel-card">
                        <div class="panel-title">
                            <span class="material-icons">flash_on</span>
                            Actions rapides
                        </div>
                        <div class="quick-actions">
                            <button type="button" onclick="applyTemplate('construction')">
                                <span class="material-icons">home_work</span>
                                Template Construction
                            </button>
                            <button type="button" onclick="applyTemplate('it-services')">
                                <span class="material-icons">memory</span>
                                Template IT Services
                            </button>
                            <button type="button" onclick="setSmartDates()">
                                <span class="material-icons">event</span>
                                Dates +30 jours
                            </button>
                            <button type="button" onclick="setSampleBudget()">
                                <span class="material-icons">payments</span>
                                Budget sugg√©r√©
                            </button>
                            <button type="button" onclick="copyManagerEmail()">
                                <span class="material-icons">content_copy</span>
                                Copier email admin
                            </button>
                        </div>
                        <div class="form-tip">
                            ‚ö° Ces actions acc√©l√®rent la cr√©ation tout en gardant les donn√©es modifiables
                        </div>
                    </div>

                    <div class="panel-card">
                        <div class="panel-title">
                            <span class="material-icons">checklist</span>
                            Checklist
                        </div>
                        <div class="checklist">
                            <span>
                                <span class="material-icons" style="color: var(--success);">check_circle</span>
                                Nom, type, client et chef de projet
                            </span>
                            <span>
                                <span class="material-icons" style="color: var(--warning);">schedule</span>
                                Dates de d√©but et fin
                            </span>
                            <span>
                                <span class="material-icons" style="color: var(--secondary);">security</span>
                                PIN + UUID g√©n√©r√©s
                            </span>
                            <span>
                                <span class="material-icons" style="color: var(--primary);">payments</span>
                                Budget optionnel
                            </span>
                        </div>
                    </div>

                    <div class="panel-card">
                        <div class="panel-title">
                            <span class="material-icons">insights</span>
                            R√©sum√©
                        </div>
                        <div class="summary-chip">
                            <span class="material-icons">auto_graph</span>
                            <span id="summaryText">Projet pr√™t √† cr√©er</span>
                        </div>
                    </div>

                    <div class="panel-card">
                        <div class="panel-title">
                            <span class="material-icons">help</span>
                            Aide
                        </div>
                        <div style="font-size: 13px; color: var(--gray); line-height: 1.6;">
                            <p>üìå Les champs marqu√©s d'un <span class="required">*</span> sont obligatoires</p>
                            <p>üîë Le PIN sera communiqu√© au client pour l'acc√®s √† son espace</p>
                            <p>üí° Vous pouvez modifier tous les champs apr√®s cr√©ation</p>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Modal de confirmation -->
    <div id="confirmModal" class="image-modal" onclick="if (event.target.id === 'confirmModal') document.getElementById('confirmModal').classList.remove('open')">
        <div class="image-modal-content">
            <div style="padding: 24px;">
                <h3 style="margin: 0 0 8px 0; color: var(--dark);">Confirmation</h3>
                <p id="confirmText" style="margin: 0; color: var(--gray); font-size: 14px;">√ätes-vous s√ªr ?</p>
            </div>
            <div class="image-modal-actions">
                <div class="btn-group">
                    <button class="btn-secondary" id="confirmNo">
                        <span class="material-icons">close</span>
                        Annuler
                    </button>
                    <button class="btn-primary" id="confirmYes">
                        <span class="material-icons">check</span>
                        Confirmer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import authService from '../src/auth-service.js';
        import projectStore from '../src/data-store.js';
        import ProfileService from '../src/profile-service.js';
        import { initAdminAvatar } from '../src/admin-avatar.js';

        let currentUUID = '';
        let currentPIN = '';

        // G√©n√©ration UUID
        function generateUUID() {
            currentUUID = crypto.randomUUID ? crypto.randomUUID() : generateUUIDFallback();
            document.getElementById('uuidDisplay').textContent = currentUUID;
            return currentUUID;
        }

        function generateUUIDFallback() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // G√©n√©ration PIN
        function generatePIN() {
            currentPIN = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
            document.getElementById('pinDisplay').textContent = currentPIN;
            return currentPIN;
        }

        window.generateUUID = generateUUID;
        window.generatePIN = generatePIN;

        window.copyPIN = async () => {
            try {
                await navigator.clipboard.writeText(currentPIN || document.getElementById('pinDisplay').textContent);
                showToast('success', 'PIN copi√© dans le presse-papiers');
            } catch (error) {
                showToast('error', 'Erreur lors de la copie');
            }
        };

        // Initialisation
        window.addEventListener('load', async () => {
            try {
                await authService.authReady;
                if (!authService.isAdmin || !authService.isAdmin()) {
                    window.location.href = 'login.html';
                    return;
                }
                
                await initAdminAvatar();
                generateUUID();
                generatePIN();

                try {
                    const profile = await ProfileService.getAdminProfile();
                    if (profile?.name) {
                        document.getElementById('projectManager').value = profile.name;
                    }
                } catch (profileError) {
                    console.warn('Profile auto-fill failed:', profileError);
                }
                
                updateSummary();
                
                // √âcouteurs pour mise √† jour du r√©sum√©
                document.querySelectorAll('#createProjectForm input, #createProjectForm select, #createProjectForm textarea')
                    .forEach(el => el.addEventListener('input', updateSummary));
                    
            } catch (error) {
                console.error('Auth error:', error);
                window.location.href = 'login.html';
            }
        });

        // Toast notifications
        function showToast(type, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'check_circle',
                error: 'error',
                warning: 'warning'
            };
            
            toast.innerHTML = `
                <span class="material-icons">${icons[type]}</span>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3200);
        }

        window.showToast = showToast;

        // Reset form
        window.resetForm = () => {
            document.getElementById('createProjectForm').reset();
            generateUUID();
            generatePIN();
            updateSummary();
            showToast('success', 'Formulaire r√©initialis√©');
        };

        // Mise √† jour du r√©sum√©
        function updateSummary() {
            const name = document.getElementById('name').value.trim();
            const client = document.getElementById('clientName').value.trim();
            const type = document.getElementById('type').value;
            
            const typeLabels = {
                'construction': 'üèóÔ∏è',
                'consultancy': 'üìä',
                'energy': '‚ö°',
                'it-services': 'üíª',
                'supply': 'üì¶'
            };
            
            const typeIcon = typeLabels[type] || '';
            const text = [name || 'Nouveau projet', client ? `‚Ä¢ ${client}` : '', typeIcon ? `‚Ä¢ ${typeIcon}` : ''].join(' ');
            document.getElementById('summaryText').textContent = text.trim() || 'Projet pr√™t √† cr√©er';
        }

        // Soumission du formulaire
        document.getElementById('createProjectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            if (!currentUUID) {
                showToast('warning', 'Veuillez g√©n√©rer un UUID');
                return;
            }
            
            if (!currentPIN) {
                showToast('warning', 'Veuillez g√©n√©rer un PIN');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="material-icons loading">refresh</span> Cr√©ation en cours...';
            document.getElementById('summaryText').textContent = 'Cr√©ation en cours...';

            try {
                const projectData = {
                    name: document.getElementById('name').value.trim(),
                    description: document.getElementById('description').value.trim(),
                    project_type: document.getElementById('type').value,
                    client_name: document.getElementById('clientName').value.trim(),
                    client_email: document.getElementById('clientEmail').value.trim(),
                    client_phone: document.getElementById('clientPhone').value.trim() || null,
                    project_manager: document.getElementById('projectManager').value.trim(),
                    manager_email: document.getElementById('managerEmail').value.trim() || null,
                    start_date: document.getElementById('startDate').value,
                    end_date: document.getElementById('endDate').value,
                    budget: document.getElementById('budget').value ? parseFloat(document.getElementById('budget').value) : null,
                    access_pin: currentPIN,
                    project_uuid: currentUUID,
                    status: document.getElementById('status').value,
                    location: document.getElementById('location').value.trim() || null
                };

                // Validation
                const required = [
                    { field: projectData.name, name: 'Nom du projet' },
                    { field: projectData.project_type, name: 'Type de projet' },
                    { field: projectData.client_name, name: 'Nom du client' },
                    { field: projectData.client_email, name: 'Email client' },
                    { field: projectData.project_manager, name: 'Chef de projet' },
                    { field: projectData.start_date, name: 'Date de d√©but' },
                    { field: projectData.end_date, name: 'Date de fin' }
                ];

                const missing = required.filter(r => !r.field);
                if (missing.length > 0) {
                    throw new Error(`Champs requis manquants: ${missing.map(m => m.name).join(', ')}`);
                }

                const result = await projectStore.create(projectData);

                if (result.success) {
                    showToast('success', `Projet "${projectData.name}" cr√©√© avec succ√®s`);
                    
                    if (document.getElementById('copyPinOnCreate').checked) {
                        try {
                            await navigator.clipboard.writeText(projectData.access_pin);
                            showToast('success', 'PIN copi√©');
                        } catch (copyError) {
                            console.warn('Auto-copy failed:', copyError);
                        }
                    }
                    
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2500);
                } else {
                    throw new Error(result.error || 'Erreur lors de la cr√©ation');
                }
            } catch (error) {
                console.error('Submit error:', error);
                showToast('error', error.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                document.getElementById('summaryText').textContent = 'Erreur - R√©essayer';
            }
        });

        // Logout
        window.logout = async () => {
            const confirmed = await confirmAction('Voulez-vous vraiment vous d√©connecter ?');
            if (!confirmed) return;
            
            await authService.logout();
            window.location.href = 'login.html';
        };

        // Templates
        window.applyTemplate = (type) => {
            const templates = {
                'construction': {
                    type: 'construction',
                    desc: 'Projet de construction et d√©veloppement immobilier avec suivi de chantier, gestion des mat√©riaux et coordination des √©quipes.',
                    budget: 500000
                },
                'it-services': {
                    type: 'it-services',
                    desc: 'Mise en place d‚Äôune infrastructure digitale compl√®te : d√©veloppement, d√©ploiement, maintenance et support technique.',
                    budget: 300000
                }
            };
            
            const tpl = templates[type];
            if (!tpl) return;
            
            document.getElementById('type').value = tpl.type;
            document.getElementById('description').value = tpl.desc;
            document.getElementById('budget').value = tpl.budget;
            
            updateSummary();
            showToast('success', `Template ${type === 'construction' ? 'Construction' : 'IT Services'} appliqu√©`);
        };

        window.setSmartDates = () => {
            const today = new Date();
            const end = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
            
            document.getElementById('startDate').valueAsDate = today;
            document.getElementById('endDate').valueAsDate = end;
            
            showToast('success', 'Dates renseign√©es (J +30)');
        };

        window.setSampleBudget = () => {
            if (!document.getElementById('budget').value) {
                document.getElementById('budget').value = 250000;
                showToast('success', 'Budget sugg√©r√© appliqu√© (250 000 FCFA)');
            }
        };

        window.copyManagerEmail = async () => {
            const email = document.getElementById('managerEmail').value || authService.currentUser?.email || '';
            
            if (!email) {
                showToast('warning', 'Aucun email √† copier');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(email);
                showToast('success', 'Email copi√©');
            } catch (error) {
                showToast('error', 'Erreur de copie');
            }
        };

        // Confirmation modal
        function confirmAction(message) {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirmModal');
                document.getElementById('confirmText').textContent = message;
                modal.classList.add('open');
                
                const onConfirm = () => {
                    cleanup();
                    resolve(true);
                };
                
                const onCancel = () => {
                    cleanup();
                    resolve(false);
                };
                
                function cleanup() {
                    modal.classList.remove('open');
                    document.getElementById('confirmYes').removeEventListener('click', onConfirm);
                    document.getElementById('confirmNo').removeEventListener('click', onCancel);
                }
                
                document.getElementById('confirmYes').addEventListener('click', onConfirm);
                document.getElementById('confirmNo').addEventListener('click', onCancel);
            });
        }
    </script>
  <script src="/js/refresh-feedback.js" defer></script>
</body>
</html>
