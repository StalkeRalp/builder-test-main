<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Project - TDE Group</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../src/style.css" />
    <link rel="stylesheet" href="./styles/client-theme.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom animations for the client portal */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 18px 40px 0 rgba(13, 148, 136, 0.18);
        }

        .dashboard-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        @media (max-width: 1024px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Timeline connector */
        .timeline-connector {
            position: absolute;
            left: 24px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background-color: #e2e8f0;
            z-index: 0;
        }

        .timeline-item:last-child .timeline-connector {
            display: none;
        }

        /* Smooth Tab Transition */
        .tab-content {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
</head>

<body class="client-portal bg-gray-50 text-slate-800 font-sans antialiased overflow-x-hidden">
    <!-- Authentication Guard -->
    <script type="module">
        import AuthService from '../src/auth-service.js';
        import Toast from '../src/components/toast.js';
        AuthService.preventAdminAccess();
    </script>

    <!-- LOGIN VIEW -->
    <div id="loginView" class="min-h-screen flex items-center justify-center relative overflow-hidden bg-slate-900">
        <!-- Background Effects -->
        <div class="absolute inset-0 z-0">
            <img src="/images/acceuil.jpeg" class="w-full h-full object-cover opacity-20" alt="Background">
            <div
                class="absolute inset-0 bg-gradient-to-tr from-tde-dark/95 via-tde-primary/90 to-purple-900/80 mix-blend-multiply">
            </div>
            <!-- Animated shapes -->
            <div
                class="absolute top-0 left-0 w-96 h-96 bg-purple-500 rounded-full blur-[150px] opacity-20 animate-pulse-slow">
            </div>
            <div class="absolute bottom-0 right-0 w-96 h-96 bg-pink-500 rounded-full blur-[150px] opacity-20 animate-pulse-slow"
                style="animation-delay: 1.5s;"></div>
        </div>

        <div class="relative z-10 w-full max-w-md px-4">
            <div class="glass-panel p-8 md:p-10 rounded-3xl animate-slide-up shadow-2xl">
                <div class="text-center mb-8">
                    <div
                        class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-purple-50 mb-6 shadow-inner">
                        <img src="/logo.png" alt="TDE Logo" class="w-10 h-10 object-contain">
                    </div>
                    <h1 class="font-display font-bold text-3xl text-slate-900 mb-2">My Project</h1>
                    <p class="text-slate-500">Access your project dashboard</p>
                </div>

                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Project ID or Email</label>
                        <div class="relative group">
                            <span
                                class="absolute left-4 top-3.5 text-gray-400 group-focus-within:text-slate-900 transition-colors">
                                <i data-lucide="user" class="w-5 h-5"></i>
                            </span>
                            <input type="text" id="email" required
                                class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 focus:border-transparent outline-none transition-all duration-300 placeholder-gray-400"
                                placeholder="P-2026-001" value="PROJET-ALPHA-01">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                        <div class="relative group">
                            <span
                                class="absolute left-4 top-3.5 text-gray-400 group-focus-within:text-slate-900 transition-colors">
                                <i data-lucide="lock" class="w-5 h-5"></i>
                            </span>
                            <input type="password" id="password" required
                                class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 focus:border-transparent outline-none transition-all duration-300 placeholder-gray-400"
                                placeholder="••••••••" value="password">
                        </div>
                    </div>

                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox"
                                class="w-4 h-4 rounded text-slate-900 border-gray-300 focus:ring-slate-900">
                            <span class="text-slate-600">Remember me</span>
                        </label>
                        <a href="#" class="text-slate-900 font-medium hover:underline">Need help?</a>
                    </div>

                    <!-- UPDATED: Black Button -->
                    <button type="submit" id="loginBtn"
                        class="w-full py-4 bg-slate-900 hover:bg-black text-white font-bold rounded-xl shadow-lg shadow-slate-900/30 hover:shadow-slate-900/50 hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2">
                        <span>Sign In</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </form>

                <div class="mt-8 pt-6 border-t border-gray-100 text-center space-y-4">
                    <p class="text-xs text-slate-400">&copy; 2026 TDE Group. Secure Client Portal.</p>
                    <a href="admin-login.html"
                        class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-slate-100 text-slate-600 text-xs font-bold hover:bg-slate-200 transition-colors">
                        <i data-lucide="shield" class="w-3 h-3"></i>
                        Admin Login
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD VIEW (Hidden by default) -->
    <div id="dashboardView" class="hidden bg-gray-50 dashboard-layout">

        <!-- Sidebar -->
        <aside class="bg-white border-r border-gray-200 sticky top-0 h-screen hidden lg:flex flex-col z-20">
            <div class="p-6 border-b border-gray-100 flex items-center gap-3">
                <img src="/logo.png" class="w-8 h-8 object-contain" alt="Logo">
                <span class="font-display font-bold text-xl text-slate-900">My Project</span>
            </div>

            <div class="p-4 flex-1 overflow-y-auto">
                <div class="mb-8">
                    <p class="px-4 text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Menu</p>
                    <nav class="space-y-1">
                        <button onclick="switchTab('overview')" id="nav-overview"
                            class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl bg-slate-100 text-slate-900 transition-colors">
                            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                            Overview
                        </button>
                        <button onclick="switchTab('timeline')" id="nav-timeline"
                            class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-slate-600 hover:bg-gray-50 hover:text-slate-900 transition-colors">
                            <i data-lucide="calendar-clock" class="w-5 h-5"></i>
                            Timeline
                        </button>
                        <button onclick="switchTab('tickets')" id="nav-tickets"
                            class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-slate-600 hover:bg-gray-50 hover:text-slate-900 transition-colors">
                            <i data-lucide="ticket" class="w-5 h-5"></i>
                            Tickets
                            <span
                                class="ml-auto bg-rose-100 text-rose-600 py-0.5 px-2 rounded-full text-xs font-bold">2</span>
                        </button>
                        <button onclick="switchTab('documents')" id="nav-documents"
                            class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-slate-600 hover:bg-gray-50 hover:text-slate-900 transition-colors">
                            <i data-lucide="folder-open" class="w-5 h-5"></i>
                            Documents
                        </button>
                    </nav>
                </div>

                <!-- UPDATED: Project Manager Card (Clean Style) -->
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-4">
                    <div class="flex items-start gap-3 mb-3">
                        <div
                            class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-bold overflow-hidden">
                            <!-- Placeholder avatar or initails -->
                            <i data-lucide="user" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wide">Project Manager</p>
                            <p id="sidebar-manager-name" class="font-bold text-sm text-black">--</p>
                        </div>
                    </div>
                    <button
                        class="w-full py-2 bg-white hover:bg-gray-100 rounded-lg text-xs font-bold text-slate-900 transition-colors border border-gray-200 flex items-center justify-center gap-2">
                        <i data-lucide="mail" class="w-3 h-3"></i> Contact Manager
                    </button>
                </div>

                <!-- Logout Button -->
                <button onclick="AuthService.logout()"
                    class="w-full mt-4 py-3 bg-white hover:bg-red-50 rounded-xl text-sm font-bold text-red-600 transition-colors border border-red-200 flex items-center justify-center gap-2">
                    <i data-lucide="log-out" class="w-4 h-4"></i> Logout
                </button>
            </div>

            <div class="p-4 border-t border-gray-100">
                <button onclick="logout()"
                    class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-red-600 hover:bg-red-50 transition-colors">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                    Log Out
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 min-h-screen flex flex-col">
            <!-- Mobile Header -->
            <header
                class="bg-white/90 backdrop-blur-md border-b border-gray-200 sticky top-0 z-10 px-6 py-4 flex items-center justify-between lg:justify-end">
                <div class="lg:hidden flex items-center gap-3">
                    <img src="/logo.png" class="w-8 h-8 object-contain" alt="Logo">
                    <span class="font-display font-bold text-lg text-slate-900">My Project</span>
                </div>
                <div class="flex items-center gap-4">
                    <!-- BONUS: Notification Toggle -->
                    <div class="relative">
                        <button onclick="toggleNotifications()" class="p-2 rounded-full hover:bg-gray-100 relative">
                            <i data-lucide="bell" class="w-5 h-5 text-slate-600"></i>
                            <span
                                class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white animate-pulse"></span>
                        </button>
                        <!-- Notification Dropdown -->
                        <div id="notificationDropdown"
                            class="hidden absolute right-0 mt-3 w-80 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden animate-fade-in origin-top-right z-50">
                            <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                                <h4 class="font-bold text-sm text-slate-900">Notifications</h4>
                                <span class="text-xs text-tde-primary cursor-pointer hover:underline">Mark all
                                    read</span>
                            </div>
                            <div class="max-h-64 overflow-y-auto">
                                <div class="p-4 border-b border-gray-50 hover:bg-gray-50 transition-colors">
                                    <p class="text-sm font-bold text-slate-800">New Phase Started</p>
                                    <p class="text-xs text-slate-500 mt-1">Electrical Wiring has begun.</p>
                                    <span class="text-[10px] text-gray-400 mt-2 block">2 hours ago</span>
                                </div>
                                <div class="p-4 hover:bg-gray-50 transition-colors">
                                    <p class="text-sm font-bold text-slate-800">Ticket #1024 Resolved</p>
                                    <p class="text-xs text-slate-500 mt-1">Kitchen layout changes approved.</p>
                                    <span class="text-[10px] text-gray-400 mt-2 block">Yesterday</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 pl-4 border-l border-gray-200">
                        <div
                            class="w-8 h-8 rounded-full bg-slate-900 flex items-center justify-center text-white font-bold text-sm">
                            JD
                        </div>
                        <span class="hidden md:block text-sm font-medium text-slate-700">John Doe</span>
                    </div>
                </div>
            </header>

            <div class="p-6 md:p-8 max-w-7xl mx-auto w-full">

                <!-- OVERVIEW TAB -->
                <div id="tab-overview" class="tab-content animate-fade-in">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                        <div>
                            <span id="overview-project-id"
                                class="text-sm font-bold text-slate-400 uppercase tracking-wider">Project #...</span>
                            <h2 id="overview-project-name" class="font-display font-bold text-3xl text-slate-900 mt-1">
                                Loading Project...</h2>
                        </div>
                        <div class="flex items-center gap-3">
                            <!-- BONUS: Export Button -->
                            <button onclick="exportReport()"
                                class="px-4 py-2 rounded-lg border border-gray-200 bg-white hover:bg-gray-50 text-sm font-medium text-slate-700 flex items-center gap-2 transition-colors">
                                <i data-lucide="download" class="w-4 h-4"></i> Export Report
                            </button>
                            <span id="overview-project-status"
                                class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 text-sm font-medium border border-emerald-200 flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                Loading...
                            </span>
                        </div>
                    </div>

                    <!-- Key Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div
                            class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all hover:-translate-y-1">
                            <div class="flex items-center justify-between mb-4">
                                <span class="bg-blue-50 text-blue-600 p-2 rounded-lg"><i data-lucide="bar-chart-3"
                                        class="w-6 h-6"></i></span>
                                <span id="overview-progress-text" class="text-2xl font-bold text-slate-900">0%</span>
                            </div>
                            <h3 class="text-slate-600 font-medium">Overall Progress</h3>
                            <div class="w-full bg-gray-100 rounded-full h-2 mt-3">
                                <div id="overview-progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%">
                                </div>
                            </div>
                        </div>

                        <div
                            class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all hover:-translate-y-1">
                            <div class="flex items-center justify-between mb-4">
                                <span class="bg-purple-50 text-purple-600 p-2 rounded-lg"><i data-lucide="clock"
                                        class="w-6 h-6"></i></span>
                                <span id="overview-delivery-date" class="text-xl font-bold text-slate-900">--</span>
                            </div>
                            <h3 class="text-slate-600 font-medium">Est. Delivery</h3>
                            <p class="text-xs text-green-600 mt-2 flex items-center gap-1"><i data-lucide="trending-up"
                                    class="w-3 h-3"></i> On Schedule</p>
                        </div>

                        <div
                            class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all hover:-translate-y-1">
                            <div class="flex items-center justify-between mb-4">
                                <span class="bg-amber-50 text-amber-600 p-2 rounded-lg"><i data-lucide="alert-circle"
                                        class="w-6 h-6"></i></span>
                                <span class="text-2xl font-bold text-slate-900">2</span>
                            </div>
                            <h3 class="text-slate-600 font-medium">Pending Actions</h3>
                            <button onclick="switchTab('tickets')"
                                class="text-xs text-amber-600 font-bold mt-2 hover:underline">View Tickets</button>
                        </div>
                    </div>

                    <!-- Recent Activity Section -->
                    <div class="grid lg:grid-cols-2 gap-8">
                        <!-- Project Gallery (Latest Uploads) -->
                        <div class="bg-white rounded-3xl p-6 border border-gray-100 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="font-display font-bold text-xl text-slate-900">Site Updates</h3>
                                <button class="text-sm text-slate-900 font-bold hover:underline">View Gallery</button>
                            </div>
                            <div class="grid grid-cols-2 gap-4" id="siteUpdatesGallery">
                                <div class="relative group rounded-xl overflow-hidden h-40 cursor-pointer">
                                    <img src="/building/building.jpg"
                                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                    <div
                                        class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                        <i data-lucide="zoom-in" class="text-white w-6 h-6"></i>
                                    </div>
                                </div>
                                <div class="relative group rounded-xl overflow-hidden h-40 cursor-pointer">
                                    <img src="/IT/secu1.jpg"
                                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                    <div
                                        class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                        <i data-lucide="zoom-in" class="text-white w-6 h-6"></i>
                                    </div>
                                </div>
                            </div>
                            <p class="mt-4 text-sm text-slate-500 border-t border-gray-100 pt-3">
                                <i data-lucide="info" class="w-4 h-4 inline mr-1"></i> Foundation phase completed.
                                Wiring in progress.
                            </p>
                        </div>

                        <!-- Current Phase Detail -->
                        <div class="bg-white rounded-3xl p-6 border border-gray-100 shadow-sm">
                            <h3 class="font-display font-bold text-xl text-slate-900 mb-6">Current Phase</h3>
                            <div class="space-y-6">
                                <div class="relative pl-8 pb-4 border-l-2 border-slate-900">
                                    <span
                                        class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-slate-900 border-4 border-slate-100"></span>
                                    <p class="text-sm text-slate-400 font-mono mb-1">PHASE 2.1</p>
                                    <h4 class="font-bold text-lg text-slate-900">Electrical Wiring</h4>
                                    <p class="text-slate-600 text-sm mt-2">Installation of main electrical conduits and
                                        server room cabling.</p>
                                </div>
                                <div class="relative pl-8 pb-0 border-l-2 border-slate-200">
                                    <span class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-slate-200"></span>
                                    <p class="text-sm text-slate-400 font-mono mb-1">PHASE 2.2</p>
                                    <h4 class="font-bold text-slate-400">Plumbing Systems</h4>
                                    <p class="text-slate-400 text-sm mt-2">Scheduled to start next week (Feb 10).</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TICKETS TAB -->
                <div id="tab-tickets" class="hidden tab-content animate-fade-in">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                        <div>
                            <h2 class="font-display font-bold text-3xl text-slate-900">Support Tickets</h2>
                            <p class="text-slate-500 mt-1">Direct communication with your project manager.</p>
                        </div>
                        <div class="flex gap-3">
                            <!-- BONUS: Search Bar -->
                            <div class="relative">
                                <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                                <input type="text" id="ticketSearch" placeholder="Search tickets..."
                                    class="pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 outline-none text-sm w-full md:w-64 transition-all"
                                    onkeyup="filterTickets()">
                            </div>
                            <!-- UPDATED: Black Button -->
                            <button onclick="openTicketModal()"
                                class="px-6 py-3 bg-slate-900 hover:bg-black text-white rounded-xl font-bold shadow-lg shadow-slate-900/20 transition-all hover:-translate-y-0.5 flex items-center gap-2 shrink-0">
                                <i data-lucide="plus" class="w-5 h-5"></i> Open Ticket
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm">
                        <!-- Ticket List Header -->
                        <div
                            class="grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b border-gray-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                            <div class="col-span-1">ID</div>
                            <div class="col-span-6 md:col-span-5">Subject</div>
                            <div class="col-span-2 hidden md:block">Date</div>
                            <div class="col-span-2">Status</div>
                            <div class="col-span-3 md:col-span-2 text-right">Action</div>
                        </div>

                        <!-- Ticket Items -->
                        <div id="ticketList">
                            <!-- Item 1 -->
                            <div
                                class="ticket-item grid grid-cols-12 gap-4 p-4 border-b border-gray-100 items-center hover:bg-gray-50 transition-colors">
                                <div class="col-span-1 font-mono text-sm text-slate-400">#1024</div>
                                <div class="col-span-6 md:col-span-5 font-medium text-slate-800">Change request for
                                    kitchen layout</div>
                                <div class="col-span-2 hidden md:block text-sm text-slate-500">Feb 02, 2026</div>
                                <div class="col-span-2">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">
                                        Resolved
                                    </span>
                                </div>
                                <div class="col-span-3 md:col-span-2 text-right">
                                    <button class="text-slate-400 hover:text-slate-900 transition-colors"><i
                                            data-lucide="eye" class="w-5 h-5"></i></button>
                                </div>
                            </div>

                            <!-- Item 2 -->
                            <div
                                class="ticket-item grid grid-cols-12 gap-4 p-4 border-b border-gray-100 items-center hover:bg-gray-50 transition-colors bg-blue-50/20">
                                <div class="col-span-1 font-mono text-sm text-slate-400">#1025</div>
                                <div class="col-span-6 md:col-span-5 font-medium text-slate-800">Access to server room
                                    schematics</div>
                                <div class="col-span-2 hidden md:block text-sm text-slate-500">Feb 03, 2026</div>
                                <div class="col-span-2">
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                                        In Progress
                                    </span>
                                </div>
                                <div class="col-span-3 md:col-span-2 text-right">
                                    <button class="text-slate-400 hover:text-slate-900 transition-colors"><i
                                            data-lucide="message-square" class="w-5 h-5"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LOADING Placeholder for other tabs -->
                <div id="tab-timeline" class="hidden tab-content animate-fade-in">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                        <div>
                            <h2 class="font-display font-bold text-3xl text-slate-900">Project Timeline</h2>
                            <p class="text-slate-500 mt-1">Track the progress of your construction.</p>
                        </div>
                        <div
                            class="bg-white px-4 py-2 rounded-xl border border-gray-200 shadow-sm text-sm font-medium text-slate-600">
                            Estimated Completion: <span class="text-slate-900 font-bold">May 15, 2026</span>
                        </div>
                    </div>

                    <div class="bg-white rounded-3xl p-8 border border-gray-200 shadow-sm relative overflow-hidden">
                        <!-- Connecting Line -->
                        <div class="absolute top-24 bottom-24 left-8 md:left-[3.25rem] w-0.5 bg-gray-100 z-0"></div>

                        <div class="space-y-12 relative z-10">
                            <!-- Phase 1: Completed -->
                            <div class="flex gap-6 md:gap-10">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center border-4 border-white shadow-sm">
                                        <i data-lucide="check" class="w-5 h-5 md:w-6 md:h-6"></i>
                                    </div>
                                </div>
                                <div
                                    class="flex-1 bg-gray-50 rounded-2xl p-6 border border-gray-100 transition-all hover:shadow-md">
                                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-2">
                                        <span class="text-sm font-bold text-emerald-600 uppercase tracking-wider">Phase
                                            1.0</span>
                                        <span class="text-xs text-slate-400 font-medium">Completed on Jan 15,
                                            2026</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-slate-900 mb-2">Foundation & Groundwork</h3>
                                    <p class="text-slate-600 text-sm leading-relaxed">Excavation, specialized foundation
                                        works, and initial structural concrete pouring completed successfully.</p>
                                </div>
                            </div>

                            <!-- Phase 2: Active -->
                            <div class="flex gap-6 md:gap-10">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-blue-600 text-white flex items-center justify-center border-4 border-white shadow-lg ring-4 ring-blue-50">
                                        <i data-lucide="refresh-cw" class="w-5 h-5 md:w-6 md:h-6 animate-spin"></i>
                                    </div>
                                </div>
                                <div
                                    class="flex-1 bg-white rounded-2xl p-6 border border-blue-100 shadow-lg shadow-blue-900/5 transition-all">
                                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-2">
                                        <span
                                            class="text-sm font-bold text-blue-600 uppercase tracking-wider flex items-center gap-2">
                                            Phase 2.0 <span class="relative flex h-2 w-2"><span
                                                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span><span
                                                    class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span></span>
                                        </span>
                                        <span class="text-xs text-slate-400 font-medium">In Progress • Est. Feb
                                            28</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-slate-900 mb-2">Structural Framework</h3>
                                    <p class="text-slate-600 text-sm leading-relaxed mb-4">Erection of main load-bearing
                                        structures, columns, beams, and floor slabs.</p>
                                    <!-- Progress Bar -->
                                    <div class="w-full bg-gray-100 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-1000"
                                            style="width: 65%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Phase 3: Pending -->
                            <div class="flex gap-6 md:gap-10 opacity-60 hover:opacity-100 transition-opacity">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center border-4 border-white">
                                        <i data-lucide="circle-dashed" class="w-5 h-5 md:w-6 md:h-6"></i>
                                    </div>
                                </div>
                                <div class="flex-1 bg-white rounded-2xl p-6 border border-dashed border-gray-200">
                                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-2">
                                        <span class="text-sm font-bold text-slate-400 uppercase tracking-wider">Phase
                                            3.0</span>
                                        <span class="text-xs text-slate-400 font-medium">Scheduled for Mar 01</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-slate-700 mb-2">MEP Installation</h3>
                                    <p class="text-slate-500 text-sm leading-relaxed">Mechanical, Electrical, and
                                        Plumbing
                                        systems installation.</p>
                                </div>
                            </div>

                            <!-- Phase 4: Pending -->
                            <div class="flex gap-6 md:gap-10 opacity-60 hover:opacity-100 transition-opacity">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center border-4 border-white">
                                        <i data-lucide="flag" class="w-5 h-5 md:w-6 md:h-6"></i>
                                    </div>
                                </div>
                                <div class="flex-1 bg-white rounded-2xl p-6 border border-dashed border-gray-200">
                                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-2">
                                        <span class="text-sm font-bold text-slate-400 uppercase tracking-wider">Phase
                                            4.0</span>
                                        <span class="text-xs text-slate-400 font-medium">Scheduled for May 01</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-slate-700 mb-2">Finishing & Handover</h3>
                                    <p class="text-slate-500 text-sm leading-relaxed">Interior finishing, painting,
                                        flooring, and final inspection.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-documents" class="hidden tab-content animate-fade-in">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                        <div>
                            <h2 class="font-display font-bold text-3xl text-slate-900">Document Vault</h2>
                            <p class="text-slate-500 mt-1">Access and download your project files.</p>
                        </div>
                        <div class="flex gap-2">
                            <button
                                class="px-4 py-2 rounded-lg bg-white border border-gray-200 text-sm font-bold text-slate-600 hover:bg-gray-50 transition-colors">
                                Recent
                            </button>
                            <button
                                class="px-4 py-2 rounded-lg bg-slate-900 text-white text-sm font-bold hover:bg-black transition-colors shadow-lg shadow-slate-900/20">
                                All Files
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Document Card 1 -->
                        <div
                            class="group bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-xl transition-all hover:-translate-y-1 cursor-pointer">
                            <div class="flex items-start justify-between mb-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-red-50 text-red-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i data-lucide="file-text" class="w-6 h-6"></i>
                                </div>
                                <div class="relative">
                                    <button
                                        class="p-2 hover:bg-gray-100 rounded-full text-slate-400 hover:text-slate-900 transition-colors">
                                        <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-1 truncate">Construction Contract.pdf</h3>
                            <p class="text-xs text-slate-500 mb-6">Added on Jan 05, 2026 • 2.4 MB</p>
                            <button
                                class="w-full py-2.5 rounded-xl border border-gray-200 text-sm font-bold text-slate-600 group-hover:bg-slate-900 group-hover:text-white group-hover:border-slate-900 transition-all flex items-center justify-center gap-2">
                                <i data-lucide="download" class="w-4 h-4"></i> Download
                            </button>
                        </div>

                        <!-- Document Card 2 -->
                        <div
                            class="group bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-xl transition-all hover:-translate-y-1 cursor-pointer">
                            <div class="flex items-start justify-between mb-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-blue-50 text-blue-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i data-lucide="image" class="w-6 h-6"></i>
                                </div>
                                <button
                                    class="p-2 hover:bg-gray-100 rounded-full text-slate-400 hover:text-slate-900 transition-colors">
                                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-1 truncate">Architectural Plan v2.jpg</h3>
                            <p class="text-xs text-slate-500 mb-6">Added on Jan 12, 2026 • 5.1 MB</p>
                            <button
                                class="w-full py-2.5 rounded-xl border border-gray-200 text-sm font-bold text-slate-600 group-hover:bg-slate-900 group-hover:text-white group-hover:border-slate-900 transition-all flex items-center justify-center gap-2">
                                <i data-lucide="download" class="w-4 h-4"></i> Download
                            </button>
                        </div>

                        <!-- Document Card 3 -->
                        <div
                            class="group bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-xl transition-all hover:-translate-y-1 cursor-pointer">
                            <div class="flex items-start justify-between mb-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-orange-50 text-orange-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i data-lucide="file-spreadsheet" class="w-6 h-6"></i>
                                </div>
                                <button
                                    class="p-2 hover:bg-gray-100 rounded-full text-slate-400 hover:text-slate-900 transition-colors">
                                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-1 truncate">Invoice #2026-001.xlsx</h3>
                            <p class="text-xs text-slate-500 mb-6">Added on Feb 01, 2026 • 850 KB</p>
                            <button
                                class="w-full py-2.5 rounded-xl border border-gray-200 text-sm font-bold text-slate-600 group-hover:bg-slate-900 group-hover:text-white group-hover:border-slate-900 transition-all flex items-center justify-center gap-2">
                                <i data-lucide="download" class="w-4 h-4"></i> Download
                            </button>
                        </div>

                        <!-- Document Card 4 (Empty/Upload) -->
                        <div
                            class="group bg-gray-50 p-6 rounded-2xl border-2 border-dashed border-gray-200 hover:border-slate-400 transition-all cursor-pointer flex flex-col items-center justify-center text-center">
                            <div
                                class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-slate-400 flex items-center justify-center mb-3 group-hover:text-slate-900 group-hover:border-slate-900 transition-all">
                                <i data-lucide="upload" class="w-6 h-6"></i>
                            </div>
                            <h3 class="font-bold text-slate-600 group-hover:text-slate-900 transition-colors">Upload
                                File</h3>
                            <p class="text-xs text-slate-400 mt-1">Drag & drop or click</p>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- NEW TICKET MODAL -->
    <div id="ticketModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeTicketModal()">
        </div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg p-4">
            <div class="bg-white rounded-3xl shadow-2xl animate-fade-in overflow-hidden">
                <div class="px-8 py-6 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                    <h3 class="font-display font-bold text-xl text-slate-900">New Request</h3>
                    <button onclick="closeTicketModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <form id="newTicketForm" class="p-8 space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Topic</label>
                        <select
                            class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 outline-none text-slate-700">
                            <option>Change Request</option>
                            <option>Billing Question</option>
                            <option>Meeting Request</option>
                            <option>Technical Issue</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Subject</label>
                        <input type="text" required
                            class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 outline-none text-slate-700 placeholder-gray-400"
                            placeholder="Brief summary...">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Contract Phase</label>
                            <select
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 outline-none text-slate-700">
                                <option>Phase 1.1 - Foundation</option>
                                <option selected>Phase 2.1 - Electrical</option>
                                <option>Phase 2.2 - Plumbing</option>
                                <option>Phase 3.0 - Finishing</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Priority</label>
                            <select
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 outline-none text-slate-700">
                                <option>Low</option>
                                <option selected>Medium</option>
                                <option class="text-red-600 font-bold">High</option>
                                <option class="text-red-900 font-bold uppercase">Critical</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Reference / Attachment</label>
                        <div
                            class="border-2 border-dashed border-gray-200 rounded-xl p-4 text-center hover:border-slate-400 transition-colors cursor-pointer relative">
                            <input type="file" class="absolute inset-0 opacity-0 cursor-pointer">
                            <i data-lucide="paperclip" class="w-5 h-5 mx-auto text-gray-400 mb-1"></i>
                            <span class="text-xs text-gray-500">Attach screenshot or document</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Details</label>
                        <textarea rows="4" required
                            class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-slate-900 outline-none text-slate-700 placeholder-gray-400 resize-none"
                            placeholder="Describe your request..."></textarea>
                    </div>
                    <div class="pt-2">
                        <!-- UPDATED: Black Button -->
                        <button type="submit"
                            class="w-full py-4 bg-slate-900 hover:bg-black text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2">
                            <span>Submit Request</span>
                            <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-6 right-6 transform translate-y-24 transition-transform duration-500 z-50">
        <div
            class="bg-slate-900 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4 border border-slate-700">
            <div class="w-8 h-8 rounded-full bg-emerald-500/20 text-emerald-400 flex items-center justify-center">
                <i data-lucide="check" class="w-5 h-5"></i>
            </div>
            <div>
                <h4 class="font-bold text-sm">Success</h4>
                <p class="text-xs text-slate-400">Action completed successfully.</p>
            </div>
        </div>
    </div>

    <!-- DATA STORE -->
    <script type="module" src="src/data-store.js"></script>

    <!-- Script Logic -->
    <script type="module" src="src/my-project.js"></script>
    <script>
        lucide.createIcons();

        // ---------------------------------------------------------
        // REAL DATA INTEGRATION
        // ---------------------------------------------------------
        const loginForm = document.getElementById('loginForm');

        // Check for existing session
        if (AuthService.isClient()) {
            const user = AuthService.getCurrentUser();
            console.log('Restoring session for:', user.projectName);
            // Hide login, show dashboard
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('dashboardView').classList.remove('hidden');
            // Load project data
            window.loadProjectData && window.loadProjectData(user.projectId);
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            e.stopImmediatePropagation();

            const idInput = document.getElementById('email').value.trim();
            const pinInput = document.getElementById('password').value.trim();
            const btn = document.getElementById('loginBtn');
            const originalText = btn.innerHTML;

            // Loading state
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Authenticating...`;
            lucide.createIcons();

            try {
                const result = await AuthService.loginClient(idInput, pinInput);

                if (result.success) {
                    // Success UI
                    btn.innerHTML = `<i data-lucide="check" class="w-5 h-5"></i> Success`;
                    lucide.createIcons();

                    const loginView = document.getElementById('loginView');
                    loginView.classList.add('opacity-0', 'transition-opacity', 'duration-500');

                    setTimeout(() => {
                        loginView.classList.add('hidden');
                        document.getElementById('dashboardView').classList.remove('hidden');
                        document.getElementById('dashboardView').classList.add('animate-fade-in');

                        // Load project data if function exists
                        if (window.loadProjectData) {
                            window.loadProjectData(result.project.id);
                        }
                    }, 500);

                } else {
                    // Error UI
                    Toast.error(`✗ Login Failed: ${result.error || 'Invalid ID or PIN'}`);
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    lucide.createIcons();
                }
            } catch (error) {
                console.error('Login error:', error);
                Toast.error('✗ An unexpected error occurred');
                btn.disabled = false;
                btn.innerHTML = originalText;
                lucide.createIcons();
            }
        });



        function loadProjectData(project) {
            // 1. Header & General Info
            document.querySelector('#tab-overview h2').textContent = project.name;
            document.querySelector('#tab-overview .tracking-wider').textContent = `Project #${project.id}`;
            document.querySelector('header span.text-slate-700').textContent = project.client;
            document.querySelector('header .bg-slate-900').textContent = project.client.substring(0, 2).toUpperCase();

            // 2. Overview Stats (Progress & Date)
            const statsCards = document.querySelector('#tab-overview .grid').children;
            if (statsCards.length > 0) {
                // Progress
                statsCards[0].querySelector('.text-2xl').textContent = (project.progress || 0) + '%';
                statsCards[0].querySelector('.bg-blue-600').style.width = (project.progress || 0) + '%';
                // Delivery
                statsCards[1].querySelector('.text-xl').textContent = formatDate(project.deliveryDate);
            }

            // 3. Site Updates (Gallery)
            const galleryContainer = document.getElementById('siteUpdatesGallery');
            if (galleryContainer) {
                galleryContainer.innerHTML = '';
                if (project.images && project.images.length > 0) {
                    project.images.slice(0, 2).forEach(img => {
                        galleryContainer.innerHTML += `
                            <div class="relative group rounded-xl overflow-hidden h-40 cursor-pointer">
                                <img src="${img.src}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                    <span class="text-white text-xs font-bold">${img.caption}</span>
                                </div>
                            </div>`;
                    });
                } else {
                    galleryContainer.innerHTML = '<p class="text-sm text-gray-400 col-span-2 text-center py-8">No updates yet.</p>';
                }
            }

            // 4. Timeline
            const timelineContainer = document.querySelector('#tab-timeline .space-y-12');
            if (timelineContainer && project.phases) {
                timelineContainer.innerHTML = '';
                project.phases.forEach((phase, index) => {
                    let statusColor = 'bg-gray-100 text-gray-400';
                    let icon = 'circle-dashed';
                    let borderClass = 'border-dashed border-gray-200';

                    if (phase.status === 'completed') {
                        statusColor = 'bg-emerald-100 text-emerald-600';
                        icon = 'check';
                        borderClass = 'border-gray-100 bg-gray-50';
                    } else if (phase.status === 'active') {
                        statusColor = 'bg-blue-600 text-white shadow-lg ring-4 ring-blue-50';
                        icon = 'refresh-cw';
                        borderClass = 'border-blue-100 shadow-lg shadow-blue-900/5 bg-white';
                    }

                    timelineContainer.innerHTML += `
                        <div class="flex gap-6 md:gap-10 ${phase.status === 'pending' ? 'opacity-60 hover:opacity-100' : ''}">
                            <div class="flex flex-col items-center">
                                <div class="w-10 h-10 md:w-12 md:h-12 rounded-full ${statusColor} flex items-center justify-center border-4 border-white z-10">
                                    <i data-lucide="${icon}" class="w-5 h-5 md:w-6 md:h-6 ${phase.status === 'active' ? 'animate-spin' : ''}"></i>
                                </div>
                            </div>
                            <div class="flex-1 rounded-2xl p-6 border ${borderClass} transition-all">
                                <div class="flex flex-col md:flex-row md:items-center justify-between mb-2">
                                    <span class="text-sm font-bold uppercase tracking-wider ${phase.status === 'active' ? 'text-blue-600' : 'text-slate-400'}">
                                        Phase ${index + 1}.0
                                    </span>
                                    <span class="text-xs text-slate-400 font-medium">${phase.date || 'TBD'}</span>
                                </div>
                                <h3 class="text-lg font-bold text-slate-900 mb-2">${phase.name}</h3>
                                <p class="text-slate-600 text-sm capitalize">Status: ${phase.status}</p>
                            </div>
                        </div>
                    `;
                });
            }

            // 5. Document Vault
            const docsContainer = document.querySelector('#tab-documents .grid');
            if (docsContainer && project.documents) {
                docsContainer.innerHTML = '';
                project.documents.forEach(doc => {
                    const isPdf = doc.name.toLowerCase().endsWith('.pdf');
                    const icon = isPdf ? 'file-text' : 'image';
                    const dateStr = doc.uploadDate ? new Date(doc.uploadDate).toLocaleDateString() : 'N/A';

                    docsContainer.innerHTML += `
                        <div class="group bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-xl transition-all hover:-translate-y-1 cursor-pointer" onclick="window.open('${doc.url}', '_blank')">
                            <div class="flex items-start justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-slate-50 text-slate-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i data-lucide="${icon}" class="w-6 h-6"></i>
                                </div>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-1 group-hover:text-blue-600 transition-colors truncate" title="${doc.name}">${doc.name}</h3>
                            <p class="text-xs text-slate-400 font-mono mb-4">${doc.size || 'Unknown'} • ${dateStr}</p>
                            <a href="${doc.url}" target="_blank" download="${doc.name}" onclick="event.stopPropagation()" class="w-full py-2 rounded-lg border border-gray-200 text-xs font-bold text-slate-600 hover:bg-slate-900 hover:text-white transition-colors flex items-center justify-center gap-2">
                                <i data-lucide="download" class="w-3 h-3"></i> Download
                            </a>
                        </div>
                    `;
                });
                if (project.documents.length === 0) docsContainer.innerHTML = '<p class="col-span-3 text-slate-400 text-center py-4">No documents available.</p>';
            }
            lucide.createIcons();
        }

        function formatDate(dateString) {
            if (!dateString) return 'TBD';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

    </script>
</body>

</html>
