<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Client Login - TDE Group</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../src/style.css" />
    <link rel="stylesheet" href="./styles/client-theme.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 18px 40px 0 rgba(13, 148, 136, 0.18);
        }
        
        .pin-input {
            width: 50px;
            height: 50px;
            font-size: 24px;
            text-align: center;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .pin-input:focus {
            border-color: #0d9488;
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.18);
        }
        
        .pin-input.filled {
            background: rgba(20, 184, 166, 0.12);
            border-color: #0d9488;
        }
    </style>
</head>

<body class="client-portal bg-gray-50 text-slate-800 font-sans antialiased overflow-x-hidden">

    <!-- LOGIN VIEW -->
    <div class="min-h-screen flex items-center justify-center relative overflow-hidden bg-slate-900">
        <!-- Background Effects -->
        <div class="absolute inset-0 z-0">
            <img src="/images/acceuil.jpeg" class="w-full h-full object-cover opacity-20" alt="Background">
            <div
                class="absolute inset-0 bg-gradient-to-tr from-tde-dark/95 via-tde-primary/90 to-purple-900/80 mix-blend-multiply">
            </div>
            <!-- Animated shapes -->
            <div
                class="absolute top-0 left-0 w-96 h-96 bg-purple-500 rounded-full blur-[150px] opacity-20 animate-pulse-slow">
            </div>
            <div class="absolute bottom-0 right-0 w-96 h-96 bg-pink-500 rounded-full blur-[150px] opacity-20 animate-pulse-slow"
                style="animation-delay: 1.5s;"></div>
        </div>

        <div class="relative z-10 w-full max-w-md px-4">
            <div class="glass-panel p-8 md:p-10 rounded-3xl animate-slide-up shadow-2xl">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-600 to-indigo-600 mb-6 shadow-lg">
                        <img src="/logo.png" alt="TDE Group" class="w-10 h-10 object-contain">
                    </div>
                    <h1 class="font-display font-bold text-3xl text-slate-900 mb-2">üè¢ My Project</h1>
                    <p class="text-slate-500">TDE Group Client Portal</p>
                </div>

                <form id="loginForm" class="space-y-6">
                    <!-- Project ID Input -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Project UUID</label>
                        <div class="relative group">
                            <span class="absolute left-4 top-3.5 text-gray-400 group-focus-within:text-purple-600 transition-colors">
                                <i data-lucide="hash" class="w-5 h-5"></i>
                            </span>
                            <input type="text" id="projectId" required
                                class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all duration-300 placeholder-gray-400"
                                placeholder="5312fad0-1a40-4a83-b3dc-ccba9e59cb12" autocomplete="off">
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Copier le Project UUID re√ßu par email</p>
                    </div>

                    <!-- PIN Input -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-3">Password (PIN)</label>
                        <div class="relative">
                            <span class="absolute left-4 top-3.5 text-gray-400 pointer-events-none">
                                <i data-lucide="lock" class="w-5 h-5"></i>
                            </span>
                            <input type="password" id="pinInput" maxlength="6" required
                                class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all duration-300 placeholder-gray-400 text-center tracking-widest font-mono text-lg"
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <p class="text-xs text-gray-500 mt-1">6 chiffres</p>
                    </div>

                    <!-- Remember Me -->
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" id="rememberMe" class="w-4 h-4 accent-purple-600 cursor-pointer">
                        <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">Se souvenir de moi</span>
                    </label>

                    <!-- Error Message -->
                    <div id="errorMessage" class="hidden p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-center gap-2">
                        <i data-lucide="alert-circle" class="w-4 h-4 flex-shrink-0"></i>
                        <span id="errorText">Identifiants invalides</span>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="loginBtn"
                        class="w-full py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold rounded-xl shadow-lg shadow-purple-600/30 hover:shadow-purple-600/50 hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2">
                        <span>Sign In</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>

                    <!-- Help Text -->
                    <p class="text-xs text-gray-500 text-center">
                        Besoin d'aide? Contactez <a href="mailto:support@tdegroup.com" class="text-purple-600 hover:underline">support@tdegroup.com</a>
                    </p>
                </form>

                <div class="mt-8 pt-6 border-t border-gray-100 text-center space-y-3">
                    <p class="text-xs text-slate-400">&copy; 2026 TDE Group. Secure Client Portal.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../src/client-auth-service.js"></script>
    <script src="../src/client-data-service.js"></script>
    <script src="../src/client-ui-helpers.js"></script>
    <script>
        lucide.createIcons();

        const loginForm = document.getElementById('loginForm');
        const projectIdInput = document.getElementById('projectId');
        const pinInput = document.getElementById('pinInput');
        const rememberMeCheckbox = document.getElementById('rememberMe');
        const loginBtn = document.getElementById('loginBtn');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        // Charger le Project ID m√©moris√©
        const rememberedProjectId = clientAuthService.getRememberedProjectId();
        if (rememberedProjectId) {
            projectIdInput.value = rememberedProjectId;
            rememberMeCheckbox.checked = true;
        }

        // Validation du PIN en temps r√©el
        pinInput.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 6);
            e.target.classList.toggle('filled', e.target.value.length > 0);
        });

        // Gestion du formulaire
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const projectId = projectIdInput.value.trim();
            const pin = pinInput.value;

            // Validation de base
            if (!projectId || !pin) {
                errorText.textContent = 'Veuillez remplir tous les champs';
                errorMessage.classList.remove('hidden');
                return;
            }

            if (!clientAuthService.validateProjectId(projectId)) {
                errorText.textContent = 'Format Project ID invalide. Utilisez un UUID valide.';
                errorMessage.classList.remove('hidden');
                return;
            }

            if (!clientAuthService.validatePin(pin)) {
                errorText.textContent = 'Le PIN doit contenir 6 chiffres';
                errorMessage.classList.remove('hidden');
                return;
            }

            // √âtat de chargement
            loginBtn.disabled = true;
            const originalHTML = loginBtn.innerHTML;
            loginBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Connexion...';
            lucide.createIcons();

            try {
                const { default: clientBackendService } = await import('../src/client-backend-service.js');
                const result = await clientBackendService.loginWithProjectPin(
                    projectId,
                    pin,
                    rememberMeCheckbox.checked
                );

                if (!result?.success) {
                    throw new Error(result?.error || 'Invalid credentials');
                }

                loginBtn.innerHTML = '<i data-lucide="check" class="w-5 h-5"></i> Succ√®s!';
                lucide.createIcons();

                setTimeout(() => {
                    window.location.href = './dashboard.html';
                }, 500);
            } catch (error) {
                errorText.textContent = error?.message || 'Identifiants invalides. Veuillez v√©rifier votre Project ID et PIN.';
                errorMessage.classList.remove('hidden');
                loginBtn.disabled = false;
                loginBtn.innerHTML = originalHTML;
                lucide.createIcons();

                // Animation de shake
                loginForm.classList.add('animate-pulse');
                setTimeout(() => loginForm.classList.remove('animate-pulse'), 500);
            }
        });

    </script>
</body>

</html>
